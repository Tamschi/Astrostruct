# @configure_input@

# Package-related substitution variables
package			= @PACKAGE_NAME@
version			= @PACKAGE_VERSION@
tarname			= @PACKAGE_TARNAME@
distdir			= $(tarname)-$(version)

# Prefix-related substitution variables
prefix			= @prefix@
exec_prefix		= @exec_prefix@
bindir			= @bindir@

# VPATH-related substitution variables
srcdir			= @srcdir@
VPATH			= @srcdir@

# Recursive commands
all main@EXEEXT@:
	$(MAKE) -C src $@

# Package up for distrobution
dist: $(distdir).tar.gz

$(distdir).tar.gz: FORCE $(distdir)
	tar chof - $(distdir) |\
	 gzip -9 -c >$(distdir).tar.gz
	rm -rf $(distdir)

$(distdir):
	mkdir -p $(distdir)/src
	cp $(srcdir)/configure $(distdir)
	cp $(srcdir)/Makefile.in $(distdir)
	cp $(srcdir)/src/Makefile.in $(distdir)/src
	cp $(srcdir)/src/*.cpp $(distdir)/src
	cp $(srcdir)/src/*.hpp $(distdir)/src
	cp $(srcdir)/src/config.h.in $(distdir)/src
	cp $(srcdir)/install-sh $(distdir)
	cp -r $(srcdir)/pkg $(distdir)

distcheck: $(distdir).tar.gz
	gzip -cd $+ | tar xvf -
	cd $(distdir); CXXFLAGS="-I/usr/include/freetype2" ./configure
	$(MAKE) -C $(distdir) all
	$(MAKE) -C $(distdir) \
	DESTDIR=$${PWD}/$(distdir)/_inst \
	install uninstall
	$(MAKE) -C $(distdir) clean
	rm -rf $(distdir)
	@echo "*** Package $(distdir).tar.gz is\
	 ready for distribution."

clean:
	rm -rf doc/html doc/latex
	$(MAKE) -C src $@

gitadd: clean
	git add Makefile.in
	git add configure.ac
	git add configure
	git add config.doxygen
	git add windowsbin
	git add doc
	git add install-sh
	git add README.md
	git add astrostruct.xcf
	$(MAKE) -C src $@

FORCE:
	-rm -f $(distdir).tar.gz
	-rm -rf $(distdir)

# Install Uninstall mumbo jumbo
install: all
	@echo "Not sure how this is going to be installed yet!"
	@echo "Pretend some files appeared in $(DESTDIR)/$(prefix)/share/$(package)."
	@echo "As well as a binary in $(DESTDIR)/$(bindir)."

uninstall:
	@echo "Nothing's been installed! Dummy :u"
	@echo "Pretend I removed files from $(DESTDIR)/$(prefix)/share/$(package)."
	@echo "As well as a binary from $(DESTDIR)/$(bindir)."

# Autotools mumbo jumbo
Makefile: Makefile.in config.status
	./config.status $@

config.status: configure
	./config.status --recheck

.PHONY: all clean dist FORCE distcheck install uninstall gitadd
